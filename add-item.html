<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Roboto:wght@400;500;700&amp;family=Lexend:wght@400;500;700;900&amp;family=Noto+Sans:wght@400;500;700;900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<title>Add New Stock Item - EasyStock Pro</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
      :root {
        --primary-color: #197fe5;
        --secondary-color: #e7edf3;
        --text-primary: #0e141b;
        --text-secondary: #4e7397;
        --border-color: #d0dbe7;
        --background-color: #f8fafc;}
      body {
        font-family: 'Roboto', 'Lexend', 'Noto Sans', sans-serif;
      }
      .material-icons {
        font-size: 24px;}
    </style>
</head>
<body dir="ltr">
<div class="relative flex size-full min-h-screen flex-col bg-[var(--background-color)] group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[var(--secondary-color)] px-6 md:px-10 py-4 bg-white shadow-sm">
<div class="flex items-center gap-3 text-[var(--text-primary)]">
<div class="size-7 text-[var(--primary-color)]">
<svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z" fill="currentColor"></path></svg>
</div>
<h1 class="text-xl font-semibold leading-tight tracking-[-0.015em]">EasyStock Pro</h1>
</div>
<nav class="hidden md:flex items-center gap-6">
<a class="text-[var(--text-primary)] hover:text-[var(--primary-color)] text-sm font-medium leading-normal transition-colors" href="dashboard.html">Dashboard</a>
<a class="text-[var(--text-primary)] hover:text-[var(--primary-color)] text-sm font-medium leading-normal transition-colors" href="inventory-overview.html">Inventory</a>
<a class="text-[var(--text-primary)] hover:text-[var(--primary-color)] text-sm font-medium leading-normal transition-colors" href="#">Orders</a>
<a class="text-[var(--text-primary)] hover:text-[var(--primary-color)] text-sm font-medium leading-normal transition-colors" href="#">Shipments</a>
<a class="text-[var(--text-primary)] hover:text-[var(--primary-color)] text-sm font-medium leading-normal transition-colors" href="#">Reports</a>
</nav>
<div class="flex items-center gap-4">
<button aria-label="Notifications" class="flex items-center justify-center rounded-full h-10 w-10 bg-[var(--secondary-color)] text-[var(--text-primary)] hover:bg-slate-300 transition-colors">
<span class="material-icons text-[var(--text-primary)]">notifications</span>
</button>
<div aria-label="User avatar" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-slate-200" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDvpbq3MFdKfa-ojOv22Wt3TLl2DdGCAhg6crxsDkI1rEbXbQHvCoxLZ7lUaTysbC6Wm1vT5OJzZjX-DiVK1l_4ZLk_pgGwvHQB-V_0q8RIofEFEu6gEhX2HC36qFfN21xDWj-iKRamt_TxhAsOF8bF465OeOc3Ip0R5UdFuEQUmKJ5aRp6BKyIN1OPmqd9Yu61sBWQMSIvgDtLlwhE62mgyjNMOkiaQ7AEg7REcPIzBkqDTNUIO8k5c15PctSDeQuBCkYDeUNQm1oE");'></div>
<button onclick="window.location.href='logout.html'" class="flex items-center justify-center rounded-full h-10 w-10 hover:bg-red-50 text-red-600 hover:text-red-700 transition-colors" title="Logout">
<span class="material-icons">logout</span>
</button>
<button aria-label="Menu" class="md:hidden flex items-center justify-center rounded-full h-10 w-10 bg-[var(--secondary-color)] text-[var(--text-primary)] hover:bg-slate-300 transition-colors">
<span class="material-icons text-[var(--text-primary)]">menu</span>
</button>
</div>
</header>
<main class="flex flex-1 justify-center py-8 px-4 sm:px-6 lg:px-8">
<div class="w-full max-w-2xl bg-white p-6 sm:p-8 rounded-xl shadow-lg">
<header class="mb-8 text-center sm:text-left">
<h2 class="text-[var(--text-primary)] text-2xl sm:text-3xl font-bold leading-tight">Add New Stock Item</h2>
<p class="text-[var(--text-secondary)] mt-1 text-sm">Fill in the details below to add a new item to your inventory.</p>
</header>
<form class="space-y-6" id="addItemForm">
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="item-name">Item Name</label>
<input class="form-input mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm placeholder:text-[var(--text-secondary)]" id="item-name" placeholder="e.g., Premium Quality T-Shirt" type="text" required/>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="quantity">Quantity</label>
<input class="form-input mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm placeholder:text-[var(--text-secondary)]" id="quantity" placeholder="e.g., 100" type="number" min="1" required/>
</div>
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="barcode">Barcode (SKU)</label>
<div class="relative mt-1">
<input class="form-input block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 pl-4 pr-12 text-sm placeholder:text-[var(--text-secondary)]" id="barcode" placeholder="Scan or enter barcode" type="text"/>
<button aria-label="Scan barcode" class="absolute inset-y-0 right-0 flex items-center pr-3 text-[var(--text-secondary)] hover:text-[var(--primary-color)]" type="button" id="scanButton">
<span class="material-icons">qr_code_scanner</span>
</button>
</div>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="category">Category</label>
<select class="form-select mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm text-[var(--text-secondary)]" id="category" required>
<option value="">Select category</option>
<option value="electronics">Electronics</option>
<option value="apparel">Apparel</option>
<option value="groceries">Groceries</option>
<option value="furniture">Furniture</option>
<option value="books">Books</option>
<option value="sports">Sports & Outdoors</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="supplier">Supplier</label>
<select class="form-select mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm text-[var(--text-secondary)]" id="supplier" required>
<option value="">Select supplier</option>
<option value="supplier_a">Global Electronics Ltd.</option>
<option value="supplier_b">Fashion Forward Inc.</option>
<option value="supplier_c">Quality Goods Co.</option>
<option value="supplier_d">Tech Solutions LLC</option>
</select>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="price">Selling Price ($)</label>
<input class="form-input mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm placeholder:text-[var(--text-secondary)]" id="price" placeholder="e.g., 29.99" type="number" step="0.01" min="0"/>
</div>
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="cost">Cost Price ($)</label>
<input class="form-input mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm placeholder:text-[var(--text-secondary)]" id="cost" placeholder="e.g., 15.00" type="number" step="0.01" min="0"/>
</div>
</div>
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="reorder-point">Reorder Point</label>
<input class="form-input mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 h-12 px-4 text-sm placeholder:text-[var(--text-secondary)]" id="reorder-point" placeholder="e.g., 10" type="number" min="0"/>
<p class="mt-1 text-xs text-[var(--text-secondary)]">Minimum quantity before reordering is needed</p>
</div>
<div>
<label class="block text-sm font-medium text-[var(--text-primary)] pb-1.5" for="description">Description</label>
<textarea class="form-textarea mt-1 block w-full rounded-lg border-[var(--border-color)] bg-slate-50 focus:border-[var(--primary-color)] focus:ring focus:ring-[var(--primary-color)] focus:ring-opacity-50 p-4 text-sm placeholder:text-[var(--text-secondary)]" id="description" placeholder="Detailed description of the item..." rows="4"></textarea>
</div>
<div class="border-t border-[var(--border-color)] pt-6 flex flex-col sm:flex-row items-center justify-end gap-3">
<button class="flex w-full sm:w-auto items-center justify-center rounded-lg h-11 px-6 bg-[var(--secondary-color)] text-[var(--text-primary)] hover:bg-slate-300 text-sm font-medium transition-colors" type="button" onclick="window.location.href='dashboard.html'">
                  Cancel
                </button>
<button class="flex w-full sm:w-auto items-center justify-center rounded-lg h-11 px-6 bg-[var(--primary-color)] text-white text-sm font-medium hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-color)]" type="submit">
<span class="material-icons mr-2 -ml-1">add_circle_outline</span>
                  Add Item
                </button>
</div>
</form>
</div>
</main>
</div>
</div>
<script>
      // تحميل نظام إدارة البيانات
      const dataScript = document.createElement('script');
      dataScript.src = 'js/data-manager.js';
      document.head.appendChild(dataScript);

      // تحميل نظام الإشعارات
      const notificationScript = document.createElement('script');
      notificationScript.src = 'js/notifications.js';
      document.head.appendChild(notificationScript);

      script.onload = function() {
        // التحقق من تسجيل الدخول
        const currentUser = dataManager.getCurrentUser();
        if (!currentUser) {
          window.location.href = 'login.html';
          return;
        }

        // تحديث اسم المستخدم في الواجهة
        updateUserInfo(currentUser);

        // معالجة نموذج إضافة المنتج
        document.getElementById('addItemForm').addEventListener('submit', function(e) {
          e.preventDefault();

          // جمع بيانات النموذج
          const formData = {
            name: document.getElementById('item-name').value.trim(),
            sku: document.getElementById('barcode').value.trim() || generateSKU(),
            quantity: parseInt(document.getElementById('quantity').value) || 0,
            category: document.getElementById('category').value,
            supplier: document.getElementById('supplier').value,
            description: document.getElementById('description').value.trim(),
            price: parseFloat(document.getElementById('price')?.value) || 0,
            cost: parseFloat(document.getElementById('cost')?.value) || 0,
            reorderPoint: parseInt(document.getElementById('reorder-point')?.value) || 10
          };

          // التحقق من صحة البيانات
          const validation = validateProductData(formData);
          if (!validation.isValid) {
            showMessage(validation.message, 'error');
            return;
          }

          // التحقق من عدم تكرار SKU
          const existingProduct = dataManager.getProducts().find(p => p.sku === formData.sku);
          if (existingProduct) {
            showMessage('رمز المنتج (SKU) موجود بالفعل. يرجى استخدام رمز مختلف.', 'error');
            return;
          }

          // إظهار حالة التحميل
          const submitBtn = e.target.querySelector('button[type="submit"]');
          const originalText = submitBtn.innerHTML;
          submitBtn.innerHTML = '<span class="material-icons animate-spin mr-2">refresh</span>جاري الإضافة...';
          submitBtn.disabled = true;

          // إضافة المنتج
          setTimeout(() => {
            try {
              const newProduct = dataManager.addProduct(formData);

              // إرسال إشعار
              if (window.notificationSystem) {
                notificationSystem.notifyProductAdded(newProduct);
              }

              showMessage(`تم إضافة المنتج "${newProduct.name}" بنجاح!`, 'success');

              // إعادة تعيين النموذج
              document.getElementById('addItemForm').reset();

              // إعادة توجيه إلى صفحة المخزون بعد 2 ثانية
              setTimeout(() => {
                window.location.href = 'inventory-overview.html';
              }, 2000);

            } catch (error) {
              console.error('Error adding product:', error);
              showMessage('حدث خطأ أثناء إضافة المنتج. يرجى المحاولة مرة أخرى.', 'error');
              submitBtn.innerHTML = originalText;
              submitBtn.disabled = false;
            }
          }, 1000);
        });

        // تحديث قوائم الفئات والموردين من البيانات الموجودة
        updateCategoriesAndSuppliers();
      };

      // دالة التحقق من صحة البيانات
      function validateProductData(data) {
        if (!data.name) {
          return { isValid: false, message: 'يرجى إدخال اسم المنتج' };
        }

        if (!data.category) {
          return { isValid: false, message: 'يرجى اختيار فئة المنتج' };
        }

        if (!data.supplier) {
          return { isValid: false, message: 'يرجى اختيار المورد' };
        }

        if (data.quantity < 0) {
          return { isValid: false, message: 'الكمية لا يمكن أن تكون سالبة' };
        }

        if (data.price < 0) {
          return { isValid: false, message: 'السعر لا يمكن أن يكون سالباً' };
        }

        return { isValid: true };
      }

      // دالة توليد SKU تلقائي
      function generateSKU() {
        const prefix = 'ESP'; // EasyStock Pro
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        return `${prefix}-${timestamp}-${random}`;
      }

      // دالة تحديث معلومات المستخدم
      function updateUserInfo(user) {
        // يمكن إضافة عرض اسم المستخدم في الواجهة هنا
        console.log('Current user:', user.name);
      }

      // دالة تحديث قوائم الفئات والموردين
      function updateCategoriesAndSuppliers() {
        const products = dataManager.getProducts();

        // استخراج الفئات الفريدة
        const categories = [...new Set(products.map(p => p.category))];
        const categorySelect = document.getElementById('category');

        // إضافة الفئات الموجودة
        categories.forEach(category => {
          if (!Array.from(categorySelect.options).some(option => option.value === category)) {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
          }
        });

        // استخراج الموردين الفريدين
        const suppliers = [...new Set(products.map(p => p.supplier))];
        const supplierSelect = document.getElementById('supplier');

        // إضافة الموردين الموجودين
        suppliers.forEach(supplier => {
          if (!Array.from(supplierSelect.options).some(option => option.value === supplier)) {
            const option = document.createElement('option');
            option.value = supplier;
            option.textContent = supplier;
            supplierSelect.appendChild(option);
          }
        });
      }

      // دالة عرض الرسائل
      function showMessage(message, type) {
        // إزالة الرسائل السابقة
        const existingMessage = document.querySelector('.form-message');
        if (existingMessage) {
          existingMessage.remove();
        }

        // إنشاء رسالة جديدة
        const messageDiv = document.createElement('div');
        messageDiv.className = `form-message fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
          type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
        }`;
        messageDiv.innerHTML = `
          <div class="flex items-center gap-2">
            <span class="material-icons">${type === 'success' ? 'check_circle' : 'error'}</span>
            <span>${message}</span>
          </div>
        `;

        document.body.appendChild(messageDiv);

        // إزالة الرسالة بعد 5 ثوان
        setTimeout(() => {
          messageDiv.remove();
        }, 5000);
      }

      // Barcode scanner simulation
      document.getElementById('scanButton').addEventListener('click', function() {
        // Simulate barcode scanning
        const mockBarcodes = ['1234567890123', '9876543210987', '5555666677778', '1111222233334'];
        const randomBarcode = mockBarcodes[Math.floor(Math.random() * mockBarcodes.length)];
        document.getElementById('barcode').value = randomBarcode;

        // Show feedback
        this.style.color = 'var(--primary-color)';
        setTimeout(() => {
          this.style.color = '';
        }, 1000);
      });

      // Basic RTL support toggle for demonstration.
      const toggleRtlButton = document.createElement('button');
      toggleRtlButton.textContent = 'Toggle RTL/LTR';
      toggleRtlButton.style.position = 'fixed';
      toggleRtlButton.style.bottom = '10px';
      toggleRtlButton.style.right = '10px';
      toggleRtlButton.style.padding = '10px';
      toggleRtlButton.style.backgroundColor = 'var(--primary-color)';
      toggleRtlButton.style.color = 'white';
      toggleRtlButton.style.border = 'none';
      toggleRtlButton.style.borderRadius = '5px';
      toggleRtlButton.style.cursor = 'pointer';
      toggleRtlButton.style.zIndex = '1000';
      toggleRtlButton.addEventListener('click', () => {
        if (document.body.dir === 'rtl') {
          document.body.dir = 'ltr';
          document.querySelectorAll('.material-icons.mr-2').forEach(el => { el.classList.remove('ml-2'); el.classList.add('mr-2');});
        } else {
          document.body.dir = 'rtl';
           document.querySelectorAll('.material-icons.mr-2').forEach(el => { el.classList.remove('mr-2'); el.classList.add('ml-2');});
        }
      });
      document.body.appendChild(toggleRtlButton);

      // Mock menu toggle for mobile
      const menuButton = document.querySelector('button[aria-label="Menu"]');
      const nav = document.querySelector('header nav');
      if (menuButton && nav) {
        menuButton.addEventListener('click', () => {
          nav.classList.toggle('hidden');
          nav.classList.toggle('absolute');
          nav.classList.toggle('top-16');
          nav.classList.toggle('left-0');
          nav.classList.toggle('right-0');
          nav.classList.toggle('bg-white');
          nav.classList.toggle('shadow-md');
          nav.classList.toggle('p-4');
          nav.classList.toggle('flex-col');
          nav.classList.toggle('gap-4');
        });
      }
    </script>

</body>
</html>
